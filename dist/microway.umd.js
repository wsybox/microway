(function(v,M){typeof exports=="object"&&typeof module<"u"?M(exports):typeof define=="function"&&define.amd?define(["exports"],M):(v=typeof globalThis<"u"?globalThis:v||self,M(v.microway={}))})(this,function(v){"use strict";const M=e=>e&&e.hasOwnProperty("__IS_VNODE")&&e.__IS_VNODE,_=(e,t)=>t.type===e,A=(e,t)=>{let i;return e==="Text"||e==="Comment"?i={children:[t]}:i=t,i.type=e,i.__IS_VNODE=!0,i},j=(e,t)=>document.createElement(e,t),k=(e,t,i)=>document.createElementNS(e,t,i),U=()=>document.createDocumentFragment(),q=e=>document.createTextNode(e),J=(e="")=>document.createComment(e),Q=e=>e.nodeType===1,X=e=>e.nodeType===3,Z=e=>e.nodeType===8,ee=e=>e.nodeType===11,R=(e,t,i)=>{e.insertBefore(t,i)},te=(e,t)=>{e.removeChild(t)},W=(e,t)=>{e.appendChild(t)},ne=(e,t,i)=>{e.replaceChild(t,i)},re=(e,t)=>e.cloneNode(t),ie=e=>e.parentNode,oe=e=>e.nextSibling,se=(e,...t)=>{e.append(...t)},ce=e=>e.tagName,fe=(e,t)=>e[t],le=(e,t,i)=>{e[t]=i},$=[void 0,null],P={Element:j,ElementNS:k,Text:q,Fragment:U,Comment:J,isElement:Q,isText:X,isComment:Z,isFragment:ee,insertBefore:R,removeChild:te,appendChild:W,replaceChild:ne,insertFragmentBefore:R,appendFragment:W,cloneNode:re,parentNode:ie,nextSibling:oe,append:se,tagName:ce,getProperty:fe,setProperty:le,getAttribute:(e,t)=>e.getAttribute(t),setAttribute:(e,t,i)=>{$.includes(i)?e.removeAttribute(t):e.setAttribute(t,i)},getAttributeNS:(e,t,i)=>e.getAttributeNS(t,i),setAttributeNS:(e,t,i,s)=>{$.includes(s)?e.removeAttributeNS(t,i):e.setAttributeNS(t,i,s)},className:(e,t)=>{$.includes(t)?e.removeAttribute("class"):e.className=t},addEventListener:(e,t,i,s)=>{e.addEventListener(t,i,s)},removeEventListener:(e,t,i,s)=>{e.removeEventListener(t,i,s)},setTextContent:(e,t)=>{e.textContent=t},getTextContent:e=>e.textContent,SVGElements:new Set(["altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","stop","svg","switch","symbol","text","textPath","tref","tspan","use","view","vkern"])},de=Object.prototype.toString,H=e=>de.call(e),L=e=>typeof e=="function",I=Array.isArray,x=e=>e===void 0,Y=e=>e!==void 0,ue=e=>x(e)||e===null,V=e=>typeof e=="string",me=e=>typeof e=="number",G=e=>e===!0||e===!1,F=e=>V(e)||me(e)||e instanceof String||e instanceof Number,B=e=>H(e)==="[object Object]",z=/^(?![0-9-_.])[\w-.:]+$/,O=new Error("compilerToVNode: TemplateStrings format error"),ae=(e,t)=>{let i,s="";const C=[];if(t.length===0)s=e[0],i=s.split(/\s+/)[0];else{let o=[...e.raw];o.length===1?o=[o[0].trim()]:(o.unshift(o.shift().replace(/^\s*/g,"")),o.push(o.pop().replace(/\s*$/g,""))),o=o.map(f=>f.split(/\s+/)).flat();let l,c,r;for(;o.length>0;)if(c=o.shift(),i===void 0){if(z.test(c))i=c,s+=i+" ";else throw O;c=void 0}else if(c===""||c.endsWith("=")){if(l=c,c=o.shift(),c==="")if(l==="")if(r=t.shift(),Object.prototype.toString.call(r)==="[object Object]")C.push(r),r=void 0;else throw O;else{const f=l.slice(0,-1);if(z.test(f))r=t.shift(),["string","number","boolean"].includes(typeof r)?s+=`${l}'${r}' `:C.push({[f]:r}),r=void 0;else throw O}else throw O;l=void 0,c=void 0}else s+=c+" ",c=void 0}return{tag:i,tpl:s,data:C}},ge=["transform","identify","patch","create","replace","reference"],K=e=>ge.includes(e),pe=(e,...t)=>{const i={[Symbol.toStringTag]:"LTag",strs:e,vals:t};return Object.assign((...s)=>({...i,children:s}),i)},he=(...e)=>{const t={api:P},i={},s={},C={get:n=>s[n]||(s[n]=[]),add:(n,d)=>{K(n)&&(x(s[n])?s[n]=[d]:s[n].push(d))}};let o,l;for(o of e)if(typeof o=="function"&&(o=o({...t,...i},C)),Y(o)&&B(o))for(l in o)l.startsWith("_")?x(i[l])&&(i[l]=o[l]):l==="api"&&t.api===P?t.api=o.api:x(t[l])&&(t[l]=o[l]);const{api:c}=t,r=n=>{if(M(n))return n;if(F(n))return A("Text",n);if(H(n)==="[object LTag]"){const{strs:d,vals:a,children:u}=n,{data:g,tag:p,tpl:b}=ae(d,a),y=c.SVGElements.has(p);return A("Element",{data:g,tag:p,tpl:b,isSVG:y,children:u})}else if(s.transform){let d,a;for(a of s.transform)if(d=a(n),d)return d}},f=(n,d)=>{const{children:a}=n;if(["Element","Fragment"].includes(n.type)&&a&&a.length>0){let u,g;for(u=0;u<a.length;u++)g=r(a[u]),g&&d&&(g=d(g,a.length===1)),a.splice(u,1,g),g=void 0}},m=new Map,h=n=>{let d=m.get(n);if(!d){const a=c.Element("template");a.innerHTML=n,m.set(n,d=a.content.childNodes)}if(d.length>1){const a=c.Fragment();return d.forEach(u=>a.append(c.cloneNode(u,!0))),a}else return d.length===1?c.cloneNode(d[0],!0):void 0},E=(n,d)=>{n.root&&_("Fragment",n.vnode)?n.html="":_("Element",n.vnode)&&(n.html=`<${n.vnode.tpl}>`);const a=(u,g)=>{const p=[];if(_("Element",u)){const{data:b}=u;if(b&&b.length>0&&b.forEach(y=>{let S;e:for(S in y){if(s.patch){let w;for(w of s.patch)if(w(S,y[S],p))continue e}F(y[S])?u.tpl+=`${S}='${y[S]}' `:(L(y[S])||B(y[S])||I(y[S]))&&p.push([S,y[S]])}}),p.length>0){const y="__RID_"+d.size;return T({vnode:u,id:y,reference:p,parent:n,only:g},d),n.html+=`<!--${y}-->`,A("Comment",y)}else n.html+=`<${u.tpl}>`}else if(_("Text",u)&&F(u.children[0]))n.html+=u.children[0];else if(s.identify){let b,y;for(y of s.identify)if(b=y(u,n,d,T,g),b)return b}return f(u,a),_("Element",u)&&p.length===0&&(n.html+=`</${u.tag}>`),u};f(n.vnode,a),_("Element",n.vnode)&&(n.html+=`</${n.vnode.tag}>`)},N=(n,d)=>{const a=document.createNodeIterator(n.elm,NodeFilter.SHOW_COMMENT);let u;for(;u=a.nextNode();){const g=u.nodeValue;if(g){const p=d.get(g);if(p&&p.elm)c.replaceChild(u.parentNode,p.elm,u);else if(s.replace){let b;for(b of s.replace)if(b(u,g,n,d,T))break}}}if(c.isElement(n.elm)&&n.reference&&n.reference.length){let g,p;e:for([g,p]of n.reference){if(s.reference){let b;for(b of s.reference)if(b(g,p,n.elm))continue e}F(p)||G(p)||p===null?c.setAttribute(n.elm,g,p):g!=="effects"&&c.setProperty(n.elm,g,p)}}},T=(n,d=new Map)=>{if(d.set(n.root?"":n.id,n),E(n,d),n.html)n.elm=h(n.html);else if(s.create){let a;for(a of s.create)if(a(n,h,T))break}return n.elm&&N(n,d),d};return Object.assign(t,{fragment:(...n)=>{const a={vnode:A("Fragment",{children:n}),root:!0};return T(a),a.elm}})},ye=(e,t)=>{const i={class:[(o,l,c)=>{if(G(c))return o.classList[c?"add":"remove"](l),!0}],style:[(o,l,c)=>{if(V(c))return o.style[l]=c,!0}],on:[(o,l,c)=>{if(L(c))return o.addEventListener(l,c),!0}],data:[(o,l,c)=>{if(F(c)||G(c)||c===null)return o.dataset[l]=c+"",!0}]},s={get:o=>i[o]||(i[o]=[]),add:(o,l)=>{x(i[o])?i[o]=[l]:i[o].push(l)}},C=Object.keys(i);return t.add("reference",(o,l,c)=>{if(I(l)&&o==="class")return l.forEach(r=>{V(r)&&c.classList.add(r)}),!0;if(L(l)&&o.startsWith("on")){const r=i.on[0];return r(c,o.slice(2),l),!0}else if(B(l)&&C.includes(o))return Object.entries(l).forEach(([r,f])=>{let m;for(m of i[o])if(m(c,r,f))break}),!0}),{_actions:s}},Ne=({api:e,_signal:t,_actions:i},s)=>{const C=new WeakSet,o=(r,f,m)=>{let h=e.getProperty(r,"effects");return x(h)&&(e.setProperty(r,"effects",h=new Map),C.add(r)),h.set(f,t.effect(m)),r},l=(r,f)=>{const m=e.getProperty(r,"effects");Y(m)&&C.has(r)&&(x(f)?(C.delete(r),m.forEach(h=>t.stop(h)),m.clear()):m.has(f)&&(t.stop(m.get(f)),m.delete(f)))};return s.add("transform",r=>{if(t.is(r)&&F(t.get(r)))return A("Text",r);if(L(r)){const f=r();if(M(f)||I(f))return A("Fragment",{dynamic:r})}}),s.add("patch",(r,f,m)=>{if(t.is(f))return m.push([r,f]),!0}),s.add("identify",(r,f,m,h,E)=>{if(_("Text",r)&&t.is(r.children[0])){const N=r.children[0];r.children=void 0;const T="__RID_"+m.size;return h({vnode:r,id:T,parent:f,signalText:N,only:E},m),f.html+=`<!--${T}-->`,A("Comment",T)}else if(_("Fragment",r)&&r.dynamic){const N="__RID_"+m.size;return h({vnode:r,id:N,parent:f,dynamic:r.dynamic,only:E},m),f.html+=`<!--__DYNAMIC_START${N}--><!--${N}--><!--__DYNAMIC_END${N}-->`,A("Comment",N)}}),s.add("create",(r,f,m)=>{const{vnode:h,signalText:E,dynamic:N}=r;if(_("Text",h)&&t.is(E))return r.elm=e.Text(t.get(E)),o(r.elm,"signalText",()=>e.setTextContent(r.elm,t.get(E))),!0;if(_("Fragment",h)&&N){const D={vnode:A("Fragment",{children:[N()].flat()}),root:!0};return m(D),r.elm=D.elm,!0}}),s.add("replace",(r,f,m,h,E)=>{if(f.startsWith("__DYNAMIC_START")){const N=f.slice(15),T=h.get(N);T.start=r}else if(f.startsWith("__DYNAMIC_END")){const N=f.slice(13),T=h.get(N);T.end=r;const{start:D,end:n,dynamic:d}=T,a=t.memo(d);o(n,"dynamic",()=>{const u=e.parentNode(n),g=t.get(a),p=ue(g)?void 0:[g].flat(),b=p&&p.length>0;let y;for(;(y=e.nextSibling(D))!==n;)e.removeChild(u,y);if(b){const w={vnode:A("Fragment",{children:p}),root:!0};E(w),e.insertBefore(u,w.elm,n)}})}}),["style","class","on","data"].forEach(r=>{i.add(r,(f,m,h)=>{if(t.is(h)){const E=i.get(r)[0],N=()=>E(f,m,t.get(h));return N(),o(f,r+":"+m,N),!0}})}),s.add("reference",(r,f,m)=>{if(t.is(f)){const h=()=>e.setAttribute(m,r,t.get(f));return h(),o(m,r,h),!0}}),{_track:o,_untrack:l}};v.baseModule=ye,v.htmlDomApi=P,v.init=he,v.isHookName=K,v.l=pe,v.signalModule=Ne,Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})});
